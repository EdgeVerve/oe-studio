<dom-module id="attribute-element">
  <template>
        <style>
             :host {
                display: block;
                position: relative;
            }

            oe-input,
            oe-json-input,
            oe-decimal,
            oe-combo {
                --paper-input-container: {
                    background: #263238;
                    padding: 2px 8px;
                    border-radius: 2px;
                    box-sizing: border-box;
                }
                --paper-input-container-input: {
                    font-size: 12px;
                    color: #ffffff;
                    opacity: 0.87;
                }
                --paper-input-container-underline: {
                    display: none;
                }
                --paper-input-container-underline-focus: {
                    display: none;
                }
            }

            .info-box {
                padding: 12px 0px;
                position: relative;
            }

            .info-box .row-actions {
                visibility: hidden;
                position: absolute;
                right: 0px;
            }

            .info-box:hover .row-actions {
                visibility: visible;
            }

            .info-label {
                font-size: 12px;
                padding: 6px 0px;
                min-width: 60px;
                color: #fff;
                opacity: 0.54;
            }

            .info-label .attr-name {
                text-overflow: ellipsis;
                white-space: nowrap;
                overflow: hidden;
            }

            .info-box:hover .info-label .attr-name {
                max-width: 90px;
            }

            oe-checkbox {
                --paper-checkbox-unchecked-color: rgba(255, 255, 255, 0.6);
            }

            paper-toggle-button {
                --paper-toggle-button-unchecked-bar-color: rgba(255, 255, 255, 0.6);
            }

            .delete-icon {
                width: 18px;
                height: 18px;
            }
        </style>
        <div class="attribute-info layout horizontal center">
            <div class="info-box flex">
                <div class="info-label layout horizontal center justified">
                    <span class="flex attr-name">{{attrObj.name}}</span>
                    <div class="layout horizontal center row-actions">
                        <template is="dom-if" if="{{!isString(attrObj.type)}}">
                            <paper-toggle-button checked="{{attrObj.isBindedValue}}"></paper-toggle-button>
                            <span class="helper-text">{{_generateLabel(attrObj.isBindedValue)}}</span>
                        </template>
  <iron-icon icon="delete" class="delete-icon" on-tap="deleteAttribute"></iron-icon>
  </div>
  </div>
  <div class="info-value">
    <template is="dom-if" restamp if="{{attrObj.isBindedValue}}">
                        <oe-input pattern="^(\{\{[0-9a-zA-Z\.]+\}\}|\[\[[0-9a-zA-Z\.]+\]\])$" no-label-float value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-input>
                    </template>
    <template is="dom-if" restamp if="{{!attrObj.isBindedValue}}">
                        <template is="dom-if" restamp if="{{_showControl('String',attrObj.type)}}">
                            <oe-input no-label-float value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-input>
                        </template>
    <template is="dom-if" restamp if="{{_showControl('Boolean',attrObj.type)}}">
                            <oe-checkbox value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-checkbox>
                        </template>
    <template is="dom-if" restamp if="{{_showControl('Object',attrObj.type)}}">
                            <oe-json-input no-label-float value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-json-input>
                        </template>
    <template is="dom-if" restamp if="{{_showControl('Array',attrObj.type)}}">
                            <oe-json-input no-label-float value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-json-input>
                        </template>
    <template is="dom-if" restamp if="{{_showControl('Number',attrObj.type)}}">
                            <oe-decimal precision="0" no-label-float value="{{attrObj.value}}" on-change="saveAttrConfiguration"></oe-decimal>
                        </template>
    </template>
  </div>
  </div>
  </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'attribute-element',
    properties: {
      attrObj: {
        type: Array,
        value: function() {
          return {};
        },
        notify: true
      }
    },
    isString: function(type) {
      if (type == 'String' || type == 'string') {
        return true;
      }
      return false;
    },
    _generateLabel: function(flag) {
      return flag ? 'Bind value' : 'Custom';
    },
    deleteAttribute: function(event) {
      this.fire('delete-attribute', event);
    },
    _showControl: function(type, attrType) {
      if (!attrType) {
        attrType = 'String';
      }
      return (type === attrType);
    },
    saveAttrConfiguration: function(event) {
      var obj = this.attrObj;
      if (!obj.value && obj.type != 'Boolean') {
        return;
      }
      if (obj.isBindedValue && obj.type != 'String') {
        if (!event.currentTarget.validate()) {
          return;
        }
      }
      if (obj.type == 'String') {
        if (/[\{\{\}\}\[\[\]\]]+/g.test(obj.value)) {
          if (!event.currentTarget.validate()) {
            return;
          }
        }
      }
      this.fire('save-attribute', event);
    }
  })

</script>
